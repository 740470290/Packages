window.ajax=(function () {
  const f = 'http://192.168.2.118:9000';// 配置全局地址
  return {
    url:f,
    get: function (u, d, c) {
      let x = new XMLHttpRequest();
      if(c){
        u +='?';
        for (let i in d) {
          u += i + '=' + d[i] + '&'
        }
      }
      x.open('GET', f + u, true);
      // x.withCredentials = true; // 配置是否发送cookie
      x.send();
      x.onreadystatechange = function () {
        if (x.readyState === 4) {
          c?c(JSON.parse(x.response)):d(JSON.parse(x.response));
          x = null
        }
      }
    },
    post: function (u, d, c) {
      let x = new XMLHttpRequest();
      x.open('POST', f + u, true);
      if(!d.innerHTML){
        x.setRequestHeader('content-type', 'application/x-www-form-urlencoded');
      let s = '';
      for (let i in d) {
        s += i + '=' + d[i] + '&'
      }
      x.send(s);
      }else{
        const form = new FormData(d);
        x.send(form);
      }
      x.onreadystatechange = function () {
        if (x.readyState === 4 && x.status === 200) {
          c(JSON.parse(x.response));
          x = null
        }
      }
    },
    jsonp: function (u, c) {
      const n = 'jsonp' + Math.random().toString().slice(2);
      const s = document.createElement('script');
      const h = document.head;
      s.src = u + (u.includes('?') ? '&' : '?') + 'cb=' + n;
      h.appendChild(s);
      window[n] = function (r) {
        c(r);
        delete window[n];
        h.removeChild(s)
      }
    }
  }
})();
